---
title: Packaging Software on OBS
permalink: Tools/Sailfish_SDK/OBS_Packaging
parent: Sailfish SDK
layout: default
nav_order: 400
---

This page deals specifically with building packages using the [Open Build Service](/Services/Development/Open_Build_Service) instance.

This requires the user to create a home project, and then create a package
under that project, with the appropriate `_service` file to specify how the
project should be built and packaged. Once the build has been triggered, OBS
will attempt to pull in the required dependencies and build the package.

## Setting up the Home Project

## Adding a Package

### `tar_git`

### Plain tarball

### Other

### Adjusting Spec files and build systems for `tar_git`

Common modifications required to get RPMs built on the OBS:

#### Understanding the tarballs generated by `tar_git`

The service clones the repository and produces a tarball from it, which you should use as a `Source` in the .spec file.

The tarball produced has the following properties:

 - it will be named `_service:tar_git:%{name}-%{specialversion}-%{specialrevision}.tar.bz2` (see below)
 - it will contain a directory be named `%{name}-%{specialversion}-%{specialrevision}`
 - the directory will:
   - contain the content of the repository, but will not include the `.git` directory (so any git calls in your build process will not function).
   - contain clones of all submodules (usually the "upstream" submodule), also without `.git`
   - the same applies to submodules within submodules.

`%specialversion` will consist of:
 - if a tag parameter was specified n the `_service`, it will be used as the version
 - if a branch parameter was specified n the `_service`, it will be appended to the name, along with the hash of the git ref, prepended by the letter "g".
 - if no tag parameter was specified n the `_service`, but a branch name was, it will contain the value of the *latest* tag in the branch, and branch name, timestamp, and git ref hash appended to it.

`%specialrevision` will have the format X.Y.Z where:
 - X is always 1
 - Y is a counter which roughly corresponds to the number of revisions of the OBS package source.
 - Z is a counter starting at 1 and increasing each time OBS decides to automatically rebuild the package (usually because a dependency was rebuilt or newly published)

Note that these autogenerated revision and version parameters will replace the
%version and %revision macros in the spec file throughout the OBS build
process. So you cannot use literal version or revision contents in your build
setup. If you need those, you need to parse `%version` and `%revision`.

#### Examples
```
  <param name="url">https://github.com/nephros/foo.git</param>
  <param name="branch">development</param>
  <param name="revision"></param>
```
`_service:tar_git:foo-2.1+development.20240215221650.74.g0773230.tar.bz2` if the development branch contains a tag called 2.1, 

```
  <param name="url">https://github.com/nephros/foo.git</param>
  <param name="branch">development</param>
  <param name="revision">2.2</param>
```
`_service:tar_git:foo-2.2+development.20240215221650.74.g0773230.tar.bz2`

```
  <param name="url">https://github.com/nephros/foo.git</param>
  <param name="branch"></param>
  <param name="revision">2.2+git3</param>
```
`_service:tar_git:foo-2.2+git3.tar.bz2`


#### Adjust the %setup macro parameters

Because o the structure of the tarball explained above, usually the `%prep`
section of .spec files will have to be adjusted to use the submodule directory
as the main source.

So if the upstream submodule is called "upstream", the line should look like

```
%prep
%setup -q -n %{name}-%{version}/upstream
```

### Common errors

```
<services>
  <service name="tar_git">
  <param name="url">https://github.com/nephros/foo.git</param>
  <param name="branch">development</param>
  <param name="revision">0.9.9+git3</param>
  <param name="token"/>
  <param name="debian">N</param>
  <param name="dumb">N</param>
</service>
</services>
```
#### "There is no packaging in this clone"

Your project does either not contain the file, `rpm/application.spec`, or the `rpm` directory contains more than one .spec file.
In the latter case, see ###TODO on how to deal with such a structure.

#### "Couldn't clone repository"
### "Files could not be expanded: service error: ERROR: couldn't clone foo"

Check the parameters in the `_service` file:

```
  <param name="url">https://github.com/sailfishos-chum/qt6.git</param>
  <param name="branch">gcc</param>
```


